(function(){"use strict";function p(i,t,e,d,r,_,n,o){var a=typeof i=="function"?i.options:i;return t&&(a.render=t,a.staticRenderFns=e,a._compiled=!0),{exports:i,options:a}}const m={extends:"k-button",props:{pageid:String,basename:String,extension:String,url:String,isposterrequired:String,posterfieldname:String},methods:{async handleGenerateVideoPoster(){const t=["pageid","basename","extension","url","isposterrequired"].filter(n=>{const o=this[n];return o==null||o===""});if(t.length>0){console.warn("(Generate Video Poster) Invalid props:",t.join(", "));return}let e=document.querySelector(".k-file-preview-frame video"),d=!1;e?e.readyState||await new Promise(n=>{e.addEventListener("loadedmetadata",n,{once:!0})}):(d=!0,e=document.createElement("video"),e.src=this.url,e.crossOrigin="anonymous",e.muted=!0,e.playsInline=!0,await new Promise(n=>{e.addEventListener("loadedmetadata",n,{once:!0})}),e.currentTime=0,await new Promise(n=>{e.addEventListener("seeked",n,{once:!0})}));const r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight,r.getContext("2d").drawImage(e,0,0,r.width,r.height),r.toBlob(async n=>{try{const o=u=>{const w=Math.floor(u),P=Math.round(u%1*100).toString().padStart(2,"0");return`${w}_${P}`},a=this.basename+"."+this.extension,l=this.basename+"_"+o(e.currentTime)+".png",s=new FormData;s.append("pageId",this.pageid),s.append("videoFilename",a),s.append("posterFilename",l),s.append("posterFile",n,l),s.append("posterFieldname",this.posterfieldname);const c=await fetch("/generate-video-poster/upload",{method:"POST",body:s});if(!c.ok)throw new Error("(Generate Video Poster) Upload failed - Response Status: "+c.status);(await c.json()).success&&this.$reload()}catch(o){console.error("(Generate Video Poster) Upload failed - Error:",o)}finally{d&&(e.src="",e.removeAttribute("src"),e.load(),e.remove()),r.width=0,r.height=0}},"image/jpeg",.8)}},mounted(){parseInt(this.isposterrequired)===1&&this.handleGenerateVideoPoster()}};var h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-generate-video-poster"},[e("k-button",t._b({staticClass:"k-generate-video-poster-button",attrs:{icon:"image",variant:"filled"},on:{click:t.handleGenerateVideoPoster}},"k-button",t.$props,!1),[t._v("Generate Video Poster")])],1)},f=[],v=p(m,h,f);const g=v.exports;panel.plugin("eriksiemund/generate-video-poster",{fields:{generatevideoposter:g}})})();
