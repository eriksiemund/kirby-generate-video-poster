(function(){"use strict";function c(a,n,e,d,o,v,t,i){var r=typeof a=="function"?a.options:a;return n&&(r.render=n,r.staticRenderFns=e,r._compiled=!0),{exports:a,options:r}}const p={extends:"k-button",props:{pageid:String,basename:String,extension:String,url:String,isposterrequired:String,posterfieldname:String},methods:{async handleGenerateVideoPoster(){const n=["pageid","basename","extension","url","isposterrequired"].filter(t=>{const i=this[t];return i==null||i===""});if(n.length>0){console.warn("(Generate Video Poster) Invalid props:",n.join(", "));return}let e=document.querySelector(".k-file-preview-frame video"),d=!1;e?(e.readyState||await new Promise(t=>{e.addEventListener("loadedmetadata",t,{once:!0})}),await e.play(),await new Promise(t=>setTimeout(t,100)),e.pause()):(d=!0,e=document.createElement("video"),e.src=this.url,e.crossOrigin="anonymous",e.muted=!0,e.playsInline=!0,await new Promise(t=>{e.addEventListener("loadedmetadata",t,{once:!0})}),e.currentTime=0,await new Promise(t=>{e.addEventListener("seeked",t,{once:!0})}));const o=document.createElement("canvas");o.width=e.videoWidth,o.height=e.videoHeight,o.getContext("2d").drawImage(e,0,0,o.width,o.height),o.toBlob(async t=>{try{const i=this.basename+"."+this.extension,r=this.basename+"_poster.jpeg",s=new FormData;s.append("pageId",this.pageid),s.append("videoFilename",i),s.append("posterFilename",r),s.append("posterFile",t,r),s.append("posterFieldname",this.posterfieldname);const l=await fetch("/generate-video-poster/upload",{method:"POST",body:s});if(!l.ok)throw new Error("(Generate Video Poster) Upload failed - Response Status: "+l.status);(await l.json()).success&&this.$reload()}catch(i){console.error("(Generate Video Poster) Upload failed - Error:",i)}finally{d&&(e.src="",e.removeAttribute("src"),e.load(),e.remove()),o.width=0,o.height=0}},"image/jpeg",.8)}},mounted(){parseInt(this.isposterrequired)===1&&this.handleGenerateVideoPoster()}};var u=function(){var n=this,e=n._self._c;return e("div",{staticClass:"k-generate-video-poster"},[e("k-button",n._b({staticClass:"k-generate-video-poster-button",attrs:{icon:"image",variant:"filled"},on:{click:n.handleGenerateVideoPoster}},"k-button",n.$props,!1),[n._v("Generate Video Poster")])],1)},m=[],f=c(p,u,m);const h=f.exports;panel.plugin("eriksiemund/generate-video-poster",{fields:{generatevideoposter:h}})})();
