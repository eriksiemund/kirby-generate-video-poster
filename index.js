(function(){"use strict";function u(i,t,e,d,n,_,o,r){var s=typeof i=="function"?i.options:i;return t&&(s.render=t,s.staticRenderFns=e,s._compiled=!0),{exports:i,options:s}}const m={extends:"k-button",props:{pageid:String,basename:String,extension:String,url:String,isposterrequired:String,posterfieldname:String},methods:{async handleGenerateVideoPoster(){const t=["pageid","basename","extension","url","isposterrequired"].filter(o=>{const r=this[o];return r==null||r===""});if(t.length>0){console.warn("(Generate Video Poster) Invalid props:",t.join(", "));return}let e=document.querySelector(".k-file-preview-frame video"),d=!1;e||(d=!0,e=document.createElement("video"),e.src=this.url,e.crossOrigin="anonymous",e.muted=!0,e.playsInline=!0,await new Promise(o=>{e.addEventListener("loadedmetadata",o,{once:!0})}),e.currentTime=0,await new Promise(o=>{e.addEventListener("seeked",o,{once:!0})}));const n=document.createElement("canvas");n.width=e.videoWidth,n.height=e.videoHeight,n.getContext("2d").drawImage(e,0,0,n.width,n.height),n.toBlob(async o=>{try{const r=p=>{const w=Math.floor(p),P=Math.round(p%1*100).toString().padStart(2,"0");return`${w}_${P}`},s=this.basename+"."+this.extension,l=this.basename+"_"+r(e.currentTime)+".png",a=new FormData;a.append("pageId",this.pageid),a.append("videoFilename",s),a.append("posterFilename",l),a.append("posterFile",o,l),a.append("posterFieldname",this.posterfieldname);const c=await fetch("/generate-video-poster/upload",{method:"POST",body:a});if(!c.ok)throw new Error("(Generate Video Poster) Upload failed - Response Status: "+c.status);(await c.json()).success&&this.$reload()}catch(r){console.error("(Generate Video Poster) Upload failed - Error:",r)}finally{d&&(e.src="",e.removeAttribute("src"),e.load(),e.remove()),n.width=0,n.height=0}},"image/png")}},mounted(){parseInt(this.isposterrequired)===1&&this.handleGenerateVideoPoster()}};var h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-generate-video-poster"},[e("k-button",t._b({staticClass:"k-generate-video-poster-button",attrs:{icon:"image",variant:"filled"},on:{click:t.handleGenerateVideoPoster}},"k-button",t.$props,!1),[t._v("Generate Video Poster")])],1)},f=[],v=u(m,h,f);const g=v.exports;panel.plugin("eriksiemund/generate-video-poster",{fields:{generatevideoposter:g}})})();
